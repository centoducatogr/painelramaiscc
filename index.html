<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel de Ramais com WhatsApp</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f0f2f5;
      margin: 0;
      padding: 20px;
      color: #333;
      cursor: default;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 24px;
    }

    .container {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 15px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .card {
      background: white; /* Fundo padr√£o branco */
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 150px;
      position: relative;
      border-left: 5px solid #ddd;
      transition: all 0.3s ease;
    }

    /* Fundo azul claro para chamadas entrando */
    .card.status-calling {
      background-color: #d4e6f1 !important;
    }

    /* Fundo vermelho claro para agentes offline */
    .card.status-offline {
      background-color: #f5b7b1 !important;
    }

    /* Borda lateral vermelha para offline */
    .card.offline-border {
      border-left: 5px solid #F44336 !important;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 10px;
      right: 10px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: #ccc;
    }

    /* Piscar em azul quando estiver tocando */
    .card.combined-calling {
      animation: pulse-border-blue 1.5s infinite;
    }

    @keyframes pulse-border-blue {
      0% { border: 2px solid #2196F3; }
      50% { border: 2px solid #bbdefb; }
      100% { border: 2px solid #2196F3; }
    }

    .card h3 {
      margin: 0 0 8px 0;
      font-size: 15px;
      font-weight: bold;
      line-height: 1.3;
    }

    .agent, .status, .whatsapp-status {
      font-size: 13px;
      margin: 3px 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .status.calling  { color: #2196F3; font-weight: bold; }
    .status.in-use   { color: #FF9800; }
    .status.online   { color: #006400; }
    .status.offline  { color: #292929; }

    .whatsapp-status.online  { color: #006400; }
    .whatsapp-status.active  { color: #128C7E; font-weight: 500; }
    .whatsapp-status.offline { color: #292929; }

    .icon {
      font-size: 16px;
      margin-right: 5px;
    }

    .card.combined-online::before    { background-color: #4CAF50; }
    .card.combined-in-use::before    { background-color: #FF9800; }
    .card.combined-calling::before   { background-color: #2196F3; }
    .card.combined-offline::before   { background-color: #F44336; }

    /* Bot√µes flutuantes */
    .controls {
      position: fixed;
      top: 20px;
      left: 20px;
      display: flex;
      gap: 10px;
      z-index: 1000;
    }

    .btn {
      width: 44px;
      height: 44px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: transform 0.2s;
    }

    .btn:hover { transform: scale(1.05); }

    #btn-fullscreen { background-color: #7f8c8d; }
    #btn-fullscreen.full { background-color: #3498db; }

    #btn-stop-som {
      background-color: #e74c3c;
    }

    #btn-stop-som.muted {
      background-color: #95a5a6;
    }

    /* Bot√µes de atualiza√ß√£o */
    .refresh-controls {
      text-align: center;
      margin: 20px auto;
      padding: 15px;
      max-width: 800px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      justify-content: center;
      gap: 15px;
      position: relative;
      z-index: 100;
      flex-wrap: wrap;
    }

    .btn-refresh {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .btn-refresh:hover { transform: translateY(-2px); }

    .btn-refresh.atualizar { background-color: #4CAF50; color: white; }
    .btn-refresh.auto { background-color: #2196F3; color: white; }
    .btn-refresh.parar { background-color: #F44336; color: white; }
  </style>
</head>
<body>

  <!-- Bot√µes: Tela Cheia e Parar Som -->
  <div class="controls">
    <button id="btn-fullscreen" title="Tela Cheia">üñ•Ô∏è</button>
    <button id="btn-stop-som" title="Parar Som">üîä</button>
  </div>

  <h1>üîî PAINEL DE MONITORAMENTO DE RAMAIS E WHATSAPP</h1>

  <div class="container" id="ramais-container">
    <!-- Cards gerados dinamicamente -->
  </div>

  <!-- Bot√µes de atualiza√ß√£o -->
  <div class="refresh-controls">
    <button id="btn-atualizar" class="btn-refresh atualizar">
      üîÑ Atualizar Agora
    </button>
    <button id="btn-auto" class="btn-refresh auto">
      ‚è±Ô∏è Atualizar a cada 3s
    </button>
    <button id="btn-parar" class="btn-refresh parar" disabled>
      ‚è∏Ô∏è Parar Atualiza√ß√£o
    </button>
  </div>

  <!-- √Åudio oculto -->
  <audio id="audioAlerta" src="painel-ramal-toque.mp3" preload="auto"></audio>

  <script>
    const audioElement = document.getElementById("audioAlerta");
    const btnFullscreen = document.getElementById("btn-fullscreen");
    const btnStopSom = document.getElementById("btn-stop-som");
    const btnAtualizar = document.getElementById("btn-atualizar");
    const btnAuto = document.getElementById("btn-auto");
    const btnParar = document.getElementById("btn-parar");

    let isFullscreen = false;
    let intervalId = null;
    let alertaInterval = null;
    let audioUnlocked = false;
    let somAtivo = true;

    // === TELA CHEIA ===
    function toggleFullscreen() {
      if (!isFullscreen) {
        document.documentElement.requestFullscreen?.() ||
        document.documentElement.webkitRequestFullscreen?.() ||
        document.documentElement.msRequestFullscreen?.();
        isFullscreen = true;
      } else {
        document.exitFullscreen?.() ||
        document.webkitExitFullscreen?.() ||
        document.msExitFullscreen?.();
        isFullscreen = false;
      }
      atualizarBotaoFullscreen();
    }

    function atualizarBotaoFullscreen() {
      btnFullscreen.textContent = isFullscreen ? 'üîΩ' : 'üñ•Ô∏è';
      btnFullscreen.classList.toggle('full', isFullscreen);
    }

    document.addEventListener("fullscreenchange", () => {
      isFullscreen = !!document.fullscreenElement;
      atualizarBotaoFullscreen();
    });

    document.addEventListener("webkitfullscreenchange", () => {
      isFullscreen = !!document.webkitFullscreenElement;
      atualizarBotaoFullscreen();
    });

    // === LIBERAR √ÅUDIO ===
    document.addEventListener("click", unlockAudio, { once: true });
    document.addEventListener("touchstart", unlockAudio, { once: true });

    function unlockAudio() {
      audioElement.play().then(() => {
        audioElement.pause();
        audioElement.currentTime = 0;
        audioUnlocked = true;
      }).catch(() => {
        audioUnlocked = true;
      });
    }

    // === BOT√ÉO: PARAR SOM ===
    btnStopSom.addEventListener("click", () => {
      somAtivo = !somAtivo;
      pararAlertaSonoro();

      if (somAtivo) {
        btnStopSom.textContent = 'üîä';
        btnStopSom.title = 'Parar Som';
        btnStopSom.classList.remove('muted');
      } else {
        btnStopSom.textContent = 'üîá';
        btnStopSom.title = 'Som Parado';
        btnStopSom.classList.add('muted');
      }
    });

    // === TOCAR SOM EM LOOP ===
    function iniciarAlertaSonoro() {
      if (!somAtivo || !audioUnlocked || alertaInterval) return;
      alertaInterval = setInterval(() => {
        audioElement.currentTime = 0;
        audioElement.play().catch(err => {
          console.warn("Erro ao tocar som:", err);
        });
      }, 3000);
    }

    function pararAlertaSonoro() {
      if (alertaInterval) {
        clearInterval(alertaInterval);
        alertaInterval = null;
      }
    }

    // === CONTROLE DE ATUALIZA√á√ÉO ===
    function iniciarAtualizacao() {
      if (intervalId) return;
      intervalId = setInterval(atualizarPainel, 3000);
      btnAuto.disabled = true;
      btnParar.disabled = false;
    }

    function pararAtualizacao() {
      if (intervalId) {
        clearInterval(intervalId);
        intervalId = null;
      }
      btnAuto.disabled = false;
      btnParar.disabled = true;
    }

    btnAtualizar.addEventListener("click", () => {
      pararAtualizacao();
      atualizarPainel();
    });

    btnAuto.addEventListener("click", iniciarAtualizacao);
    btnParar.addEventListener("click", pararAtualizacao);

    // === ATUALIZAR PAINEL ===
    function atualizarPainel() {
      const container = document.getElementById("ramais-container");
      container.innerHTML = "";

      let temChamadaTocando = false;

      ramais.forEach((ramal, index) => {
        const vozKey = getStatusVoz();
        const whatsappKey = getStatusWhatsApp();
        const voz = statusVoz[vozKey];
        const whatsapp = statusWhatsApp[whatsappKey];
        const agente = agentes[index];

        const mostraAgente = (vozKey !== "offline") || (whatsappKey === "online") || (whatsappKey === "active");
        const agenteOffline = (vozKey === "offline") || (whatsappKey === "offline");

        if (vozKey === "calling") {
          temChamadaTocando = true;
        }

        let statusFinal = "offline";
        if (mostraAgente) {
          if (vozKey === "calling") {
            statusFinal = "calling";
          } else if (vozKey === "inUse") {
            statusFinal = "in-use";
          } else {
            statusFinal = "online";
          }
        }

        const card = document.createElement("div");
        card.className = `card combined-${statusFinal}`;
        
        // üîπ Adiciona fundo azul claro se estiver tocando
        if (vozKey === "calling") {
          card.classList.add("status-calling");
        }
        // üîπ Adiciona fundo vermelho claro se agente estiver offline
        else if (agenteOffline) {
          card.classList.add("status-offline");
        }
        // üîπ Se n√£o for chamada nem offline, mant√©m branco (padr√£o)
        // ‚Üí nenhuma classe de fundo √© adicionada

        // üîπ Borda vermelha lateral se offline
        if (agenteOffline) {
          card.classList.add("offline-border");
        }

        const agenteText = mostraAgente
          ? `<span class="agent">üéß ${agente}</span>`
          : '<span class="agent" style="color:#9E9E9E">üéß -</span>';

        const whatsappText = `
          <div class="whatsapp-status ${whatsapp.class}">
            <span class="icon">${whatsapp.icon}</span>
            ${whatsapp.text}
          </div>`;

        card.innerHTML = `
          <h3>${ramal}</h3>
          ${agenteText}
          <div class="status ${voz.class}">
            <span class="icon">${voz.text.split(" ")[0]}</span>
            ${voz.text.split(" ").slice(1).join(" ")}
          </div>
          ${whatsappText}
        `;

        container.appendChild(card);
      });

      // üîî Inicia ou para o alerta sonoro
      if (temChamadaTocando && audioUnlocked && somAtivo) {
        iniciarAlertaSonoro();
      } else {
        pararAlertaSonoro();
      }
    }

    // === DADOS ===
    const ramais = [
      "BASE SASCAR 01", "BASE SASCAR 02", "BASE SASCAR 03",
      "BASE ONIXSAT 01", "BASE ONIXSAT 02", "BASE ONIXSAT 03",
      "BASE OMNILINK 01", "BASE AUTOTRAC 01",
      "BASE POSITRON 01", "BASE SIGHRA 01"
    ];

    const agentes = [
      "Maria Silva", "Carlos Oliveira", "Ana Souza", "Pedro Lima",
      "Juliana Costa", "Ricardo Almeida", "Fernanda Rocha",
      "Lucas Mendes", "Beatriz Nunes", "Eduardo Gomes"
    ];

    const statusVoz = {
      online:   { text: "üü¢ Online",        class: "online" },
      inUse:    { text: "üìû Em uso",        class: "in-use" },
      calling:  { text: "üîî Tocando",       class: "calling" },
      offline:  { text: "üî¥ Offline",       class: "offline" }
    };

    const statusWhatsApp = {
      online:   { icon: "üí¨", text: "WhatsApp Online",    class: "online" },
      active:   { icon: "üì±", text: "Em conversa",        class: "active" },
      offline:  { icon: "‚ö™", text: "WhatsApp Offline",   class: "offline" }
    };

    function getStatusVoz() {
      const r = Math.random();
      if (r < 0.4) return "online";
      if (r < 0.6) return "inUse";
      if (r < 0.8) return "calling";
      return "offline";
    }

    function getStatusWhatsApp() {
      const r = Math.random();
      if (r < 0.6) return "online";
      if (r < 0.9) return "active";
      return "offline";
    }

    // === Inicializa√ß√£o ===
    btnFullscreen.addEventListener("click", toggleFullscreen);
    atualizarBotaoFullscreen();
    atualizarPainel(); // Primeira carga
  </script>
</body>
</html>